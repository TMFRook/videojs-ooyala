var OoyalaState={UNSTARTED:-1,ENDED:0,PLAYING:1,PAUSED:2,BUFFERING:3};videojs.Ooyala=videojs.MediaTechController.extend({init:function(player,options,ready){videojs.MediaTechController.call(this,player,options,ready);this.player_=player;this.player_el_=document.getElementById(this.player_.id());this.player_el_.className+=" vjs-ooyala";var self=this;this.id_=this.player_.id()+"_ooyala_api";this.el_=videojs.Component.prototype.createEl("iframe",{id:this.id_,className:"vjs-tech",scrolling:"no",marginWidth:0,marginHeight:0,frameBorder:0,webkitAllowFullScreen:"true",mozallowfullscreen:"true",allowFullScreen:"true"});this.player_el_.insertBefore(this.el_,this.player_el_.firstChild);this.ooyala={};this.ooyalaInfo={};var self=this;this.el_.onload=function(){self.onLoad()};this.contentId=player.options()["contentId"];this.playerId=player.options()["playerId"];this.isReady_=false;if(videojs.Ooyala.apiReady){videojs.Ooyala.loadOoyala(this)}else{function loadExtScript(src,test,callback){var tag=document.createElement("script");tag.src=src;var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);var callbackTimer=setInterval(function(){var call=false;try{call=test.call()}catch(e){}if(call){clearInterval(callbackTimer);callback.call()}},100)}function waitForScript(test,callback){var callbackTimer=setInterval(function(){var call=false;try{call=test.call()}catch(e){}if(call){clearInterval(callbackTimer);callback.call()}},100)}var src="//player.ooyala.com/v3/"+this.playerId+"?platform=html5-priority";if(window.location.protocol=="file:"){src="http:"+src}if(videojs.Ooyala.apiLoading===undefined){videojs.Ooyala.apiLoading=true;loadExtScript(src,function(){return OO},function(){videojs.Ooyala.apiReady=true;videojs.Ooyala.loadOoyala(this)}.bind(this))}else{waitForScript(function(){return OO},function(){videojs.Ooyala.apiReady=true;videojs.Ooyala.loadOoyala(this)}.bind(this))}}}});videojs.Ooyala.prototype.dispose=function(){this.ooyala.dispose();this.el_.parentNode.removeChild(this.el_);videojs.MediaTechController.prototype.dispose.call(this)};videojs.Ooyala.prototype.load=function(){};videojs.Ooyala.prototype.play=function(){};videojs.Ooyala.prototype.pause=function(){};videojs.Ooyala.prototype.paused=function(){return this.ooyalaInfo.state==OoyalaState.PAUSED};videojs.Ooyala.prototype.currentTime=function(){return this.ooyalaInfo.time};videojs.Ooyala.prototype.setCurrentTime=function(seconds){};videojs.Ooyala.prototype.duration=function(){return this.ooyalaInfo.duration};videojs.Ooyala.prototype.volume=function(){return 0};videojs.Ooyala.prototype.setVolume=function(percentAsDecimal){};videojs.Ooyala.prototype.muted=function(){};videojs.Ooyala.prototype.setMuted=function(muted){};videojs.Ooyala.prototype.buffered=function(){return videojs.createTimeRange(0,this.ooyalaInfo.buffered||0)};videojs.Ooyala.prototype.supportsFullScreen=function(){return true};videojs.Ooyala.isSupported=function(){return true};videojs.Ooyala.canPlaySource=function(srcObj){return srcObj.type=="video/ooyala"};videojs.Ooyala.canControlVolume=function(){return true};videojs.Ooyala.loadOoyala=function(player){var dom_id=player.player_el_.id;var contentId=player.contentId;var playerId=player.playerId;var messageBus="vjs-ooyala-"+dom_id+"-"+player.playerId+"-"+contentId;OO.ready(function(){var ooPlayer=OO.Player.create(dom_id,contentId,{onCreate:function(ooPlayer){ooPlayer.subscribe("*",messageBus,function(eventName){});ooPlayer.subscribe("error",messageBus,function(eventName,payload){player.onError(eventName+": "+payload)});ooPlayer.subscribe("playheadTimeChanged",messageBus,function(){if(player.ooyalaInfo.duration){var buffered=ooPlayer.getBufferLength()/player.ooyalaInfo.duration;if(buffered>1){player.ooyalaInfo.buffered=1}else{player.ooyalaInfo.buffered=buffered}}var playheadTime=ooPlayer.getPlayheadTime();player.onPlayProgress(playheadTime)});ooPlayer.subscribe("playbackReady",messageBus,function(){player.ooyala=ooPlayer;player.ooyalaInfo={state:OoyalaState.UNSTARTED,volume:1,muted:false,muteVolume:1,time:0,duration:ooPlayer.getDuration()/1e3,buffered:0,error:null};player.onReady()});ooPlayer.subscribe("paused",messageBus,function(){player.onPause()});ooPlayer.subscribe("play",messageBus,function(){player.onPlay()});ooPlayer.subscribe("seekStream",messageBus,function(){var playheadTime=ooPlayer.getPlayheadTime();player.onSeek(playheadTime)});ooPlayer.subscribe("played",messageBus,function(){player.onEnded()})},autoplay:true,wmode:"opaque"})})};videojs.Ooyala.prototype.onReady=function(){this.isReady_=true;this.triggerReady()};videojs.Ooyala.prototype.onError=function(error){this.player_.error=error;this.player_.trigger("error")};videojs.Ooyala.prototype.onPause=function(){this.ooyalaInfo.state=OoyalaState.PAUSED;this.player_.trigger("pause")};videojs.Ooyala.prototype.onPlay=function(){this.ooyalaInfo.state=OoyalaState.PLAYING;this.player_.trigger("play")};videojs.Ooyala.prototype.onPlayProgress=function(seconds){this.ooyalaInfo.time=seconds;this.player_.trigger("timeupdate")};videojs.Ooyala.prototype.onEnded=function(){this.ooyalaInfo.state=OoyalaState.ENDED;this.player_.trigger("ended")};videojs.Ooyala.prototype.onSeek=function(seconds){this.ooyalaInfo.time=seconds;this.player_.trigger("timeupdate");this.player_.trigger("seeked")};